<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Lecture 5: Procedures – C404: Assembly Language</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../images/fmsi.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">C404: Assembly Language</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-lectures" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Lectures</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-lectures">    
        <li>
    <a class="dropdown-item" href="../lectures/lec01.html">
 <span class="dropdown-text">Lecture 1: Basic Concepts</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../lectures/lec02.html">
 <span class="dropdown-text">Lecture 2: Assembly Language Fundamentals</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../lectures/lec03.html">
 <span class="dropdown-text">Lecture 3: Binary Arithmetic, Logic and Addressing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../lectures/lec04.html">
 <span class="dropdown-text">Lecture 4: Branching and Looping</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../lectures/lec05.html">
 <span class="dropdown-text">Lecture 5: Procedures</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../lectures/lec06.html">
 <span class="dropdown-text">Lecture 6: More About Integer Arithmetic</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-exercises" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-exercises">    
        <li>
    <a class="dropdown-item" href="../exercises/inclass01.html">
 <span class="dropdown-text">Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/inclass02.html">
 <span class="dropdown-text">Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/inclass03.html">
 <span class="dropdown-text">Exercise 3</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <div id="quarto-announcement" data-announcement-id="f05b4cca1daa1827a0cc784371537e32" class="alert alert-primary hidden"><i class="bi bi-telegram quarto-announcement-icon"></i><div class="quarto-announcement-content">
<p>Please join the course group at <a href="https://t.me/+PE3cTMyrv5s3OGI0">FMSI-CS404-ASSEMBLY</a>; Telegram Group</p>
</div><i class="bi bi-x-lg quarto-announcement-action"></i></div>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#objectives" id="toc-objectives" class="nav-link active" data-scroll-target="#objectives">Objectives:</a></li>
  <li><a href="#stack-operations" id="toc-stack-operations" class="nav-link" data-scroll-target="#stack-operations">Stack Operations</a>
  <ul class="collapse">
  <li><a href="#run-time-stack" id="toc-run-time-stack" class="nav-link" data-scroll-target="#run-time-stack">Run-time Stack</a></li>
  <li><a href="#push-instruction" id="toc-push-instruction" class="nav-link" data-scroll-target="#push-instruction"><code>PUSH</code> Instruction</a></li>
  <li><a href="#pop-instruction" id="toc-pop-instruction" class="nav-link" data-scroll-target="#pop-instruction"><code>POP</code> Instruction</a></li>
  <li><a href="#pusha-and-popa-instructions" id="toc-pusha-and-popa-instructions" class="nav-link" data-scroll-target="#pusha-and-popa-instructions"><code>PUSHA</code> and <code>POPA</code> Instructions</a></li>
  <li><a href="#pushad-and-popad-instructions" id="toc-pushad-and-popad-instructions" class="nav-link" data-scroll-target="#pushad-and-popad-instructions"><code>PUSHAD</code> and <code>POPAD</code> Instructions</a></li>
  <li><a href="#pushfd-and-popfd-instructions" id="toc-pushfd-and-popfd-instructions" class="nav-link" data-scroll-target="#pushfd-and-popfd-instructions"><code>PUSHFD</code> and <code>POPFD</code> Instructions</a></li>
  <li><a href="#stack-applications" id="toc-stack-applications" class="nav-link" data-scroll-target="#stack-applications">Stack Applications</a></li>
  </ul></li>
  <li><a href="#procedures" id="toc-procedures" class="nav-link" data-scroll-target="#procedures">Procedures</a>
  <ul class="collapse">
  <li><a href="#call-and-ret-instructions" id="toc-call-and-ret-instructions" class="nav-link" data-scroll-target="#call-and-ret-instructions"><code>CALL</code> and <code>RET</code> Instructions</a></li>
  <li><a href="#nested-procedure-call" id="toc-nested-procedure-call" class="nav-link" data-scroll-target="#nested-procedure-call">Nested Procedure Call</a></li>
  <li><a href="#passing-register-arguments-to-procedures" id="toc-passing-register-arguments-to-procedures" class="nav-link" data-scroll-target="#passing-register-arguments-to-procedures">Passing Register Arguments to Procedures</a></li>
  <li><a href="#documenting-procedures" id="toc-documenting-procedures" class="nav-link" data-scroll-target="#documenting-procedures">Documenting Procedures</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="lec05.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li><li><a href="lec05.epub"><i class="bi bi-file"></i>ePub</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lecture 5: Procedures</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="objectives" class="level2">
<h2 class="anchored" data-anchor-id="objectives">Objectives:</h2>
<ul>
<li>Understand the run-time stack operations.</li>
<li>Learn how to define a procedure and how to call it.</li>
</ul>
</section>
<section id="stack-operations" class="level2">
<h2 class="anchored" data-anchor-id="stack-operations">Stack Operations</h2>
<ul>
<li><p>A stack is a data structure that is often called <strong>LIFO</strong> structure (Last-In, First-Out) because the last value put into the stack is always the first value taken out.</p></li>
<li><p>A stack is associated with two operations: <strong>Push</strong> and <strong>Pop</strong>.</p>
<ul>
<li><p>Push is an operation to add an element into the stack (at the top)</p></li>
<li><p>Pop is an operation to remove one element from the stack (from the top)</p></li>
</ul>
<p><img src="..\images/stack_representation.png" class="img-fluid" width="403"></p></li>
</ul>
<section id="run-time-stack" class="level3">
<h3 class="anchored" data-anchor-id="run-time-stack">Run-time Stack</h3>
<ul>
<li><p>Each process (a running program) has a <strong><em>run-time stack</em></strong>, which is a memory block managed directly by the CPU.</p></li>
<li><p>In 32-bit mode, the ESP register (known as the stack pointer) holds a 32-bit offset into some location on the stack.</p></li>
<li><p>ESP always points to the top of the run-time stack.</p></li>
<li><p>ESP can be manipulated <strong><em>manually</em></strong> or by CPU instructions: <code>PUSH</code>, <code>POP</code>, <code>CALL</code> and <code>RET</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="..\images/runtime_stack.png" class="img-fluid figure-img"></p>
<figcaption>ESP points to the top of the stack. The area above ESP (in light red) is inside the stack. The area below the ESP (light blue) is empty.</figcaption>
</figure>
</div></li>
</ul>
</section>
<section id="push-instruction" class="level3">
<h3 class="anchored" data-anchor-id="push-instruction"><code>PUSH</code> Instruction</h3>
<div class="callout callout-style-simple callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Syntax
</div>
</div>
<div class="callout-body-container callout-body">
<div class="sourceCode" id="cb1" data-code-line-numbers=""><pre class="sourceCode nasm code-with-copy"><code class="sourceCode nasm"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>      <span class="kw">PUSH</span>    <span class="op">&lt;</span>source<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<ul>
<li><p>The source operand can be either 16-bit value or 32-bit value.</p></li>
<li><p>The push operation performs the following two steps (in order):</p>
<ol type="1">
<li><p>It decrements the stack pointer (<code>ESP</code>) by the appropriate amount according to the size of the source operand:</p>
<ul>
<li><p>if the source operand is 32-bit, the stack pointer is decremented by a value of 4</p></li>
<li><p>if the source operand is 16-bit, the stack pointer is decremented by a value of 2.</p></li>
</ul></li>
<li><p>It copies a value into the location in the stack referenced by the stack pointer.</p></li>
</ol></li>
<li><p>The valid formats are:</p>
<pre data-code-line-numbers=""><code>      push    reg/mem32
      push    reg/mem16
      push    imm32</code></pre></li>
<li><p>Example:</p>
<div class="sourceCode" id="cb3" data-code-line-numbers=""><pre class="sourceCode nasm code-with-copy"><code class="sourceCode nasm"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>      <span class="kw">push</span>    <span class="dv">2024</span>    <span class="co">; 2024 =&gt; 000007E8h</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol type="1">
<li><p>Let us consider the following run-time stack as shown below; before executing <code>push</code> instruction:</p>
<p><img src="..\images/push_exm1_1.png" class="img-fluid" style="width:45.0%"></p></li>
<li><p>When <code>push 2024</code> is executed, the first step is to decrement <code>ESP</code> by 4.</p>
<p><img src="..\images/push_exm1_2.png" class="img-fluid" style="width:45.0%"></p></li>
<li><p>Then, the value <code>2024</code> , which will be treated as <code>imm32</code>, will be copied onto the stack at the location referenced by <code>ESP</code>:</p>
<p><img src="..\images/push_exm1_3.png" class="img-fluid" style="width:45.0%"></p></li>
<li><p>The above diagram shows the stack after pushing a total of four bytes.</p></li>
</ol></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The area of the stack below ESP (at lower addresses) is logically empty, and will be overwritten the next time the current program executes any instruction that pushes a value on the stack.</p>
</div>
</div>
</section>
<section id="pop-instruction" class="level3">
<h3 class="anchored" data-anchor-id="pop-instruction"><code>POP</code> Instruction</h3>
<div class="callout callout-style-simple callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Syntax
</div>
</div>
<div class="callout-body-container callout-body">
<div class="sourceCode" id="cb4" data-code-line-numbers=""><pre class="sourceCode nasm code-with-copy"><code class="sourceCode nasm"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>      <span class="kw">POP</span>   <span class="op">&lt;</span>destination<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<ul>
<li><p>The destination operand can be of size either 16-bit or 32-bit.</p></li>
<li><p>The valid formats are:</p>
<pre data-code-line-numbers=""><code>    pop   reg/mem16
    pop   reg/mem32</code></pre></li>
<li><p>The pop operation performs the following steps (in order):</p>
<ol type="1">
<li><p>It copies the value in the stack referenced by the stack pointer into the destination operand. The number of bytes to be copied is determined by the size of the destination operand.</p>
<ul>
<li><p>If the size of destination operand is 16-bit, then two bytes are tranferred into the destination operand.</p></li>
<li><p>If the size of destination operand is 32-bit, then four bytes are transferred into the destination operand</p></li>
</ul></li>
<li><p>It increments the stack pointer by the appropriate amount according to the size of the destination operand (i.e, either 2 bytes or 4 bytes).</p></li>
</ol></li>
<li><p>Example: Let us consider the previous state of the run-time stack. The following instruction pop the top value (which is 2024), and put it into <code>EAX</code> register:</p>
<div class="sourceCode" id="cb6" data-code-line-numbers=""><pre class="sourceCode nasm code-with-copy"><code class="sourceCode nasm"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>      <span class="kw">pop</span>   <span class="kw">eax</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="..\images/pop_exm1.png" class="img-fluid" style="width:100.0%"></p></li>
</ul>
<section id="flags-affected" class="level4">
<h4 class="anchored" data-anchor-id="flags-affected">Flags Affected</h4>
<p>Both push and pop instructions have no effect on EFLAGS register.</p>
</section>
</section>
<section id="pusha-and-popa-instructions" class="level3">
<h3 class="anchored" data-anchor-id="pusha-and-popa-instructions"><code>PUSHA</code> and <code>POPA</code> Instructions</h3>
<div class="callout callout-style-simple callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Syntax
</div>
</div>
<div class="callout-body-container callout-body">
<div class="sourceCode" id="cb7" data-code-line-numbers=""><pre class="sourceCode nasm code-with-copy"><code class="sourceCode nasm"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>      <span class="kw">PUSHA</span>       <span class="co">; no operand</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>      <span class="kw">POPA</span>        <span class="co">; no operand</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<ul>
<li><p><code>PUSHA</code> (push all) pushes the contents of the 16-bit general-purpose registers onto the stack. The registers are stored on the stack in the following order: AX, CX, DX, BX, SP, BP, SI, and DI.</p></li>
<li><p><code>POPA</code> (pop all) pops words from the stack into the 16-bit general purpose registers in the following order: DI, SI, BP, BX, DX, CX, and AX. The value on the stack for SP register is ignored.</p></li>
</ul>
</section>
<section id="pushad-and-popad-instructions" class="level3">
<h3 class="anchored" data-anchor-id="pushad-and-popad-instructions"><code>PUSHAD</code> and <code>POPAD</code> Instructions</h3>
<div class="callout callout-style-simple callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Syntax
</div>
</div>
<div class="callout-body-container callout-body">
<div class="sourceCode" id="cb8" data-code-line-numbers=""><pre class="sourceCode nasm code-with-copy"><code class="sourceCode nasm"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>      <span class="kw">PUSHAD</span>       <span class="co">; no operand</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>      <span class="kw">POPAD</span>        <span class="co">; no operand</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<ul>
<li><p><code>PUSHAD</code> (push all doublewords) pushes the contents of the 32-bit general-purpose registers onto the stack. The registers are stored on the stack in the following order: EAX, ECX, EDX, EBX, ESP (original value), EBP, ESI, and EDI.</p></li>
<li><p><code>POPAD</code> (pop all doublewords) pops doublewords from the stack into the 32-bit general purpose registers in the following order: EDI, ESI, EBP, EBX, EDX, ECX, and EAX. The value on the stack for ESP register is ignored.</p></li>
</ul>
</section>
<section id="pushfd-and-popfd-instructions" class="level3">
<h3 class="anchored" data-anchor-id="pushfd-and-popfd-instructions"><code>PUSHFD</code> and <code>POPFD</code> Instructions</h3>
<div class="callout callout-style-simple callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Syntax
</div>
</div>
<div class="callout-body-container callout-body">
<div class="sourceCode" id="cb9" data-code-line-numbers=""><pre class="sourceCode nasm code-with-copy"><code class="sourceCode nasm"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>      <span class="kw">PUSHAD</span>       <span class="co">; no operand              POPAD        ; no operand</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<ul>
<li><p><code>PUSHFD</code> (push flag doubleword) pushes the contents of the 32-bit EFLAGS register onto the stack.</p></li>
<li><p><code>POPFD</code> (pop flag doubleword) pops a doubleword from the stack into the 32-bit EFLAGS register.</p></li>
</ul>
</section>
<section id="stack-applications" class="level3">
<h3 class="anchored" data-anchor-id="stack-applications">Stack Applications</h3>
<section id="invoking-c-standard-library" class="level4">
<h4 class="anchored" data-anchor-id="invoking-c-standard-library">Invoking C Standard Library</h4>
<ul>
<li><p>We can invoke C standard functions from inside assembly program, such as <code>printf()</code>.</p></li>
<li><p>The instruction <code>CALL</code> is used to invoke a function. The following program prints out “Welcome to Assembly Language” to screen monitor (output console).</p></li>
</ul>
<div class="sourceCode" id="cb10" data-code-line-numbers=""><pre class="sourceCode nasm code-with-copy"><code class="sourceCode nasm"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>        <span class="kw">global</span> _main</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>        <span class="kw">extern</span> _printf      <span class="co">; tell assembler that printf() is an</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                            <span class="co">; external function</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">section</span> <span class="fu">.data</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>message <span class="dt">db</span>      <span class="st">"Welcome to Assembly Language"</span><span class="op">,</span> <span class="dv">0</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">section</span> <span class="fu">.code</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="fu">_main:</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">push</span>    message     <span class="co">; push message as argument</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">call</span>    _printf     <span class="co">; call printf() </span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">add</span>     <span class="kw">esp</span><span class="op">,</span> <span class="dv">4</span>      <span class="co">; to pop out message</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">ret</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="reverse-a-string" class="level4">
<h4 class="anchored" data-anchor-id="reverse-a-string">Reverse a String</h4>
<ul>
<li>Let’s look at a program that loops through a string and pushes each character on the stack. It then pops the letters from the stack and stores them back into the same string variable. Because the stack is a LIFO (last-in, first-out) structure, the letters in the string are reversed:</li>
</ul>
<div class="sourceCode" id="cb11" data-code-line-numbers=""><pre class="sourceCode nasm code-with-copy"><code class="sourceCode nasm"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>            <span class="kw">global</span>  _main</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>            <span class="kw">extern</span>  _printf      <span class="co">; C standard function</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>            <span class="kw">section</span> <span class="fu">.data</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>msg         <span class="dt">db</span>      <span class="st">"Hello World!"</span><span class="op">,</span> <span class="dv">0</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>            <span class="kw">section</span> <span class="fu">.text</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="fu">_main:</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>            <span class="kw">mov</span>     <span class="kw">esi</span><span class="op">,</span> <span class="dv">0</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="fu">L1:</span>         <span class="kw">movzx</span>   <span class="kw">ax</span><span class="op">,</span> <span class="dt">BYTE</span> <span class="op">[</span><span class="kw">esi</span> <span class="op">+</span> msg<span class="op">]</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>            <span class="kw">cmp</span>     <span class="kw">ax</span><span class="op">,</span> <span class="dv">0</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">jz</span>      ENDL1</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>            <span class="kw">push</span>    <span class="kw">ax</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>            <span class="kw">inc</span>     <span class="kw">esi</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">jmp</span>     L1</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ENDL1:</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>            <span class="kw">mov</span>     <span class="kw">ecx</span><span class="op">,</span> <span class="kw">esi</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>            <span class="kw">mov</span>     <span class="kw">esi</span><span class="op">,</span> <span class="dv">0</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="fu">L2:</span>         <span class="kw">pop</span>     <span class="kw">ax</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>            <span class="kw">mov</span>     <span class="op">[</span><span class="kw">esi</span> <span class="op">+</span> msg<span class="op">],</span> <span class="kw">al</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>            <span class="kw">inc</span>     <span class="kw">esi</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>            <span class="kw">loop</span>    L2</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>            <span class="kw">push</span>    msg</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">call</span>    _printf</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>            <span class="kw">add</span>     <span class="kw">esp</span><span class="op">,</span> <span class="dv">4</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>            <span class="kw">xor</span>     <span class="kw">eax</span><span class="op">,</span> <span class="kw">eax</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">ret</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="memory-to-memory-transfer" class="level4">
<h4 class="anchored" data-anchor-id="memory-to-memory-transfer">Memory to Memory Transfer</h4>
<ul>
<li><p>Let translate the following statement into assembly language using run-time stack:</p>
<div class="sourceCode" id="cb12" data-code-line-numbers=""><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> x<span class="op">;</span>      <span class="co">/* assign x to y */</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb13" data-code-line-numbers=""><pre class="sourceCode nasm code-with-copy"><code class="sourceCode nasm"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>      <span class="kw">push</span>  <span class="dt">DWORD</span><span class="op">[</span>x<span class="op">]</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>      <span class="kw">pop</span>   <span class="dt">DWORD</span><span class="op">[</span>y<span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Let us also swap two values <code>x</code> and <code>y</code> using run-time stack:</p>
<div class="sourceCode" id="cb14" data-code-line-numbers=""><pre class="sourceCode nasm code-with-copy"><code class="sourceCode nasm"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>      <span class="kw">push</span>  <span class="dt">DWORD</span><span class="op">[</span>x<span class="op">]</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>      <span class="kw">push</span>  <span class="dt">DWORD</span><span class="op">[</span>y<span class="op">]</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>      <span class="kw">pop</span>   <span class="dt">DWORD</span><span class="op">[</span>x<span class="op">]</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>      <span class="kw">pop</span>   <span class="dt">DWORD</span><span class="op">[</span>y<span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="nested-loop" class="level4">
<h4 class="anchored" data-anchor-id="nested-loop">Nested Loop</h4>
<ul>
<li><p>Recall that you need to maintain the counter value(s) of the outer loop(s)</p>
<div class="sourceCode" id="cb15" data-code-line-numbers=""><pre class="sourceCode nasm code-with-copy"><code class="sourceCode nasm"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>      <span class="kw">mov</span>   <span class="kw">ecx</span><span class="op">,</span> <span class="dv">100</span>    <span class="co">; outer loop index</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">OUTER:</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>      <span class="kw">push</span>  <span class="kw">ecx</span>         <span class="co">; store outer loop index</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>      <span class="kw">mov</span>   <span class="kw">ecx</span><span class="op">,</span> <span class="dv">20</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">INNER:</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>      .</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>      .</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>      <span class="kw">loop</span>  INNER</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>      <span class="kw">pop</span>   <span class="kw">ecx</span>         <span class="co">; restore outer loop index</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>      <span class="kw">loop</span>  OUTER</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
</section>
</section>
<section id="procedures" class="level2">
<h2 class="anchored" data-anchor-id="procedures">Procedures</h2>
<ul>
<li><p>A complicated problem is usually divided into separate tasks before it can be understood, implemented, and tested effectively.</p></li>
<li><p>This is known as <strong><em>Procedure-Oriented Programming (POP)</em></strong>.</p></li>
<li><p>In assembly language, we typically use the term procedure to mean the assembly language implementation of POP paradigm.</p></li>
<li><p>In other programming languages, procedures are often called <strong>functions</strong> or <strong>subroutines</strong>.</p></li>
<li><p>In NASM, a procedure can be placed anywhere in TEXT segment; before <code>_main</code> label, after <code>ret</code> instruction, or between <code>_main</code> and <code>ret</code>.</p></li>
<li><p>NASM has no built-in directive to support procedures. However, MASM, the other assembler, has built-in directive: <code>PROC</code> and <code>ENDP</code>.</p></li>
</ul>
<section id="call-and-ret-instructions" class="level3">
<h3 class="anchored" data-anchor-id="call-and-ret-instructions"><code>CALL</code> and <code>RET</code> Instructions</h3>
<div class="callout callout-style-simple callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Syntax
</div>
</div>
<div class="callout-body-container callout-body">
<div class="sourceCode" id="cb16" data-code-line-numbers=""><pre class="sourceCode nasm code-with-copy"><code class="sourceCode nasm"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>        <span class="cf">CALL</span>    <span class="op">&lt;</span>destination<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<ul>
<li><p>We know that the CPU fetches the instruction in memory pointed by EIP register, also known as <strong>Program Counter (PC)</strong>.</p></li>
<li><p>After fetching the instruction, the PC is automatically incremented.</p></li>
<li><p>When the instruction is executed, the PC will be already pointing to the next instruction.</p></li>
<li><p>Therefore, the <code>CALL</code> instruction performs the following operations:</p>
<ul>
<li><p>it pushes the current value of PC onto the run-time stack. Then,</p></li>
<li><p>It jumps to the destination address.</p></li>
</ul></li>
<li><p>The <code>RET</code> instruction simply pops from stack into the PC. Therefore, the EIP register will execute the instruction that follows the <code>CALL</code> instruction.</p></li>
</ul>
<div id="exm-01" class="theorem example">
<p><span class="theorem-title"><strong>Example 1</strong></span> In the following example, the procedure <code>initialize</code> sets EAX, EBX, ECX and EDX to zero. In the main program, we call this procedure to initialize data registers to zero.</p>
<div class="sourceCode" id="cb17" data-code-line-numbers=""><pre class="sourceCode nasm code-with-copy"><code class="sourceCode nasm"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">initialize:</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>      <span class="kw">xor</span>   <span class="kw">eax</span><span class="op">,</span> <span class="kw">eax</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>      <span class="kw">xor</span>   <span class="kw">ebx</span><span class="op">,</span> <span class="kw">ebx</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>      <span class="kw">xor</span>   <span class="kw">ecx</span><span class="op">,</span> <span class="kw">ecx</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>      <span class="kw">xor</span>   <span class="kw">edx</span><span class="op">,</span> <span class="kw">edx</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>      <span class="cf">ret</span>               <span class="co">; end of initialize procedure</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="fu">_main:</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>      <span class="cf">call</span>  initialize</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>      .</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>      .</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>      .</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>      <span class="cf">ret</span>               <span class="co">; end of main program</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="how-the-cpu-executes-call-and-ret-instructions" class="level4">
<h4 class="anchored" data-anchor-id="how-the-cpu-executes-call-and-ret-instructions">How the CPU Executes <code>CALL</code> and <code>RET</code> Instructions</h4>
<ul>
<li><p>The following diagrams show a program in execution along with its run-time stack. All addresses are shown in decimal format (not hexadecimal).</p></li>
<li><p>In <a href="#fig-step1" class="quarto-xref">Figure&nbsp;1</a>, the program is fetching <span class="math inline">\(instruction_1\)</span> , which is located at address <span class="math inline">\(4000\)</span>.</p>
<div id="fig-step1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-step1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="..\images/call_example_step1.png" id="fig-step1" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-step1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1
</figcaption>
</figure>
</div></li>
<li><p>When the CPU starts to execute <span class="math inline">\(instruction_1\)</span> , the EIP is pointing to <span class="math inline">\(instruction_2\)</span>, as shown in <a href="#fig-step2" class="quarto-xref">Figure&nbsp;2</a>. After instruction execution, the CPU will fetch <span class="math inline">\(instruction_2\)</span>.</p>
<div id="fig-step2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-step2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="..\images/call_example_step2.png" id="fig-step2" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-step2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2
</figcaption>
</figure>
</div></li>
<li><p>When the CPU starts to execute <span class="math inline">\(instruction_2\)</span>, the EIP is incremented and pointing to the instruction at location <span class="math inline">\(4008\)</span>, as shown in <a href="#fig-step3" class="quarto-xref">Figure&nbsp;3</a>.</p>
<div id="fig-step3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-step3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="..\images/call_example_step3.png" id="fig-step3" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-step3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3
</figcaption>
</figure>
</div></li>
<li><p>After executing <span class="math inline">\(instruction_2\)</span>, the CPU will fetch <code>CALL foo</code> instruction. Before executing this instruction, the EIP is incremented to <span class="math inline">\(4010\)</span>, as shown in <a href="#fig-step4" class="quarto-xref">Figure&nbsp;4</a>.</p>
<div id="fig-step4" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-step4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="..\images/call_example_step4.png" id="fig-step4" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-step4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4
</figcaption>
</figure>
</div></li>
<li><p>The <code>CALL</code> instruction, when executed, will perform the following two operations:</p>
<ul>
<li><p>first, It pushes the current value of EIP onto the stack.</p></li>
<li><p>second, It replaces the value of EIP with the offset address <code>FOO</code> (which has the value <span class="math inline">\(4400\)</span>). So, the CPU will branch to that address, as illustrated in <a href="#fig-step5" class="quarto-xref">Figure&nbsp;5</a>.</p></li>
</ul>
<div id="fig-step5" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-step5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="..\images/call_example_step5.png" id="fig-step5" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-step5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5
</figcaption>
</figure>
</div></li>
<li><p>Logically, the CPU will start to execute the procedure <code>FOO</code>.</p></li>
<li><p>The CPU will execute <span class="math inline">\(instruction_1\)</span>, <span class="math inline">\(instruction_2\)</span>, and <span class="math inline">\(instruction_3\)</span> of procedure <code>FOO</code>, which are located at <span class="math inline">\(4400\)</span>, <span class="math inline">\(4402\)</span>, and <span class="math inline">\(4406\)</span>, respectively.</p></li>
<li><p>After executing <span class="math inline">\(instruction_3\)</span> of procedure <code>FOO</code>, the EIP is pointing to the next instruction, which is <code>RET</code>. See <a href="#fig-step6" class="quarto-xref">Figure&nbsp;6</a>.</p>
<div id="fig-step6" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-step6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="..\images/call_example_step6.png" id="fig-step6" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-step6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6
</figcaption>
</figure>
</div></li>
<li><p>When the CPU executes <code>RET</code> instruction, it will implicitly perform the following instruction: <code>pop  EIP</code>. This implies that the value in EIP will be replaced with the value pointed by <code>ESP</code>. Then, the <code>ESP</code> will be incremented by 4. as shown in <a href="#fig-step7" class="quarto-xref">Figure&nbsp;7</a>. Consequently, the CPU will branch back to the instruction that follows the <code>CALL</code> instruction.</p>
<div id="fig-step7" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-step7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="..\images/call_example_step7.png" id="fig-step7" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-step7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7
</figcaption>
</figure>
</div></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stack Buffer Overflow
</div>
</div>
<div class="callout-body-container callout-body">
<p>The EIP register cannot be accessed directly by software; it is controlled implicitly by control-transfer instructions (such as JMP, Jcc, CALL, and RET), interrupts, and exceptions. The only way to read the EIP register is to execute a CALL instruction and then read the value of the return instruction pointer from the procedure stack. The EIP register can be loaded indirectly by modifying the value of a return instruction pointer on the procedure stack and executing a return instruction (RET or IRET).</p>
<p>A stack buffer overflow can be caused deliberately as part of an attack known as&nbsp;<strong>stack smashing</strong>. If the run-time stack is filled with data supplied from an <em>untrusted user</em> then that user can corrupt the stack in such a way as to <strong>inject executable code</strong> into the running program and take control of the process. This is one of the oldest and more reliable methods for attackers to gain unauthorized access to a computer.</p>
</div>
</div>
</section>
</section>
<section id="nested-procedure-call" class="level3">
<h3 class="anchored" data-anchor-id="nested-procedure-call">Nested Procedure Call</h3>
<ul>
<li><p>A called procedure can call another procedure before the first procedure returns. This is known as <em>nested procedure call</em>.</p></li>
<li><p>Suppose the <code>main</code> procedure calls a procedure named <code>Sub1</code>. While <code>Sub1</code> is executing, it calls the <code>Sub2</code> procedure. While <code>Sub2</code> is executing, it calls the <code>Sub3</code> procedure. The process is shown in <a href="#fig-nested" class="quarto-xref">Figure&nbsp;8</a>.</p>
<div id="fig-nested" class="quarto-float quarto-figure quarto-figure-center anchored" width="461" height="250">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-nested-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="..\images/nestedcalls.png" id="fig-nested" width="461" height="250" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-nested-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8
</figcaption>
</figure>
</div></li>
</ul>
</section>
<section id="passing-register-arguments-to-procedures" class="level3">
<h3 class="anchored" data-anchor-id="passing-register-arguments-to-procedures">Passing Register Arguments to Procedures</h3>
<ul>
<li><p>Suppose we have two vectors: <code>vec1</code> and <code>vec2</code>. The size of the two vectores are defined in a constant label named <code>VECSIZE</code>.</p></li>
<li><p>The procedure <code>addVectors</code> adds two vectors (i.e., <code>vec1</code> + <code>vec2)</code> and stores the resulted vector in <code>vec1</code>. Here is the code:</p>
<div class="sourceCode" id="cb18" data-code-line-numbers=""><pre class="sourceCode nasm code-with-copy"><code class="sourceCode nasm"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">addVectors:</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>      <span class="kw">mov</span>   <span class="kw">esi</span><span class="op">,</span> <span class="dv">0</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>      <span class="kw">mov</span>   <span class="kw">ecx</span><span class="op">,</span> VECSIZE</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">top:</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>      <span class="kw">mov</span>   <span class="kw">eax</span><span class="op">,</span> <span class="op">[</span><span class="kw">esi</span><span class="op">*</span><span class="dv">4</span> <span class="op">+</span> vec1<span class="op">]</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>      <span class="kw">add</span>   <span class="kw">eax</span><span class="op">,</span> <span class="op">[</span><span class="kw">esi</span><span class="op">*</span><span class="dv">4</span> <span class="op">+</span> vec2<span class="op">]</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>      <span class="kw">mov</span>   <span class="op">[</span><span class="kw">esi</span><span class="op">*</span><span class="dv">4</span> <span class="op">+</span> vec1<span class="op">],</span> <span class="kw">eax</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>      <span class="kw">inc</span>   <span class="kw">esi</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>      <span class="kw">loop</span>  top</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>If you call the procedure, it could only add two specific vectors (<code>vec1</code> and <code>vec2</code> ONLY). If we have another two vectors, then you need to write another procedure.</p></li>
<li><p>It’s not a good idea to include references to specific variable names inside the procedure.</p></li>
<li><p>A better approach is to pass the offset of an array to the procedure and pass an integer specifying the number of array elements. Here is a better solution:</p>
<div class="sourceCode" id="cb19" data-code-line-numbers=""><pre class="sourceCode nasm code-with-copy"><code class="sourceCode nasm"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">addVectors:</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>      <span class="kw">push</span>    <span class="kw">edi</span>         <span class="co">; EDI is pointing to the destination vector</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>      <span class="kw">push</span>    <span class="kw">esi</span>         <span class="co">; EDI is pointing to the source vector</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>      <span class="kw">push</span>    <span class="kw">ecx</span>         <span class="co">; ECX has the number of elements in the two vectors.</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">top:</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>      <span class="kw">mov</span>     <span class="kw">eax</span><span class="op">,</span> <span class="op">[</span><span class="kw">edi</span><span class="op">]</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>      <span class="kw">add</span>     <span class="kw">eax</span><span class="op">,</span> <span class="op">[</span><span class="kw">esi</span><span class="op">]</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>      <span class="kw">mov</span>     <span class="op">[</span><span class="kw">edi</span><span class="op">],</span> <span class="kw">eax</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>      <span class="kw">add</span>     <span class="kw">esi</span><span class="op">,</span> <span class="dv">4</span>      <span class="co">; goto next element</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>      <span class="kw">add</span>     <span class="kw">edi</span><span class="op">,</span> <span class="dv">4</span>      <span class="co">; goto next element</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>      <span class="kw">loop</span>    top</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>      <span class="kw">pop</span>     <span class="kw">ecx</span>         <span class="co">; restore ECX</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>      <span class="kw">pop</span>     <span class="kw">esi</span>         <span class="co">; restore ESI</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>      <span class="kw">pop</span>     <span class="kw">edi</span>         <span class="co">; restore EDI</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>      <span class="cf">ret</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>The registers <code>ESI</code>, <code>EDI</code> and <code>ECX</code> are known as <strong><em>arguments</em></strong>.</p></li>
<li><p>In the main program, you should call the procedure as follows:</p>
<div class="sourceCode" id="cb20" data-code-line-numbers=""><pre class="sourceCode nasm code-with-copy"><code class="sourceCode nasm"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>      <span class="kw">mov</span>   <span class="kw">edi</span><span class="op">,</span> vec1     <span class="co">; destination vector (first argument)</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>      <span class="kw">mov</span>   <span class="kw">esi</span><span class="op">,</span> vec2     <span class="co">; source vector (second argument)</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>      <span class="kw">mov</span>   <span class="kw">ecx</span><span class="op">,</span> VECSIZE  <span class="co">; Array size (third argument)</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>      <span class="cf">call</span>  addVector</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>In assembly language, it is common to pass arguments inside general–purpose registers.</p></li>
</ul>
<section id="saving-and-restoring-registers" class="level4">
<h4 class="anchored" data-anchor-id="saving-and-restoring-registers">Saving and Restoring Registers</h4>
<ul>
<li><p>In the <code>addVector</code> example, ECX, EDI and ESI were pushed on the stack at the beginning of the procedure and popped at the end.</p></li>
<li><p>You should save and restore registers modified by a procedure so that the calling program can be sure that none of its own register values have been overwritten.</p></li>
<li><p>The exception to this rule pertains to registers used as return values, usually EAX. Do not push and pop them.</p></li>
</ul>
</section>
</section>
<section id="documenting-procedures" class="level3">
<h3 class="anchored" data-anchor-id="documenting-procedures">Documenting Procedures</h3>
<ul>
<li><p>It is a good practice to document each procedure you have created. The document should contain at least:</p>
<ol type="1">
<li><p>A description of all tasks accomplished by the procedure.</p></li>
<li><p><strong>Receives</strong>: A list of parameters; state their usage and requirements.</p></li>
<li><p><strong>Returns</strong>: A description of values returned by the procedure.</p></li>
<li><p><strong>Requires</strong>: Optional list of requirements called preconditions that must be satisfied before the procedure is called.</p></li>
</ol></li>
<li><p>Here is an example:</p>
<div class="sourceCode" id="cb21" data-code-line-numbers=""><pre class="sourceCode nasm code-with-copy"><code class="sourceCode nasm"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">;------------------------------------------------------------</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co">; Calculates and returns the sum of three 32-bit integers.</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">;</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">; Receives : EAX, EBX, ECX, the three integers. May be signed </span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">;            or unsigned</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co">; Returns  : EAX = sum, and the status flags (Cary, Overflow, </span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co">;            etc) are changed.</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co">; Requires : nothing</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co">;------------------------------------------------------------</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="fu">SumOf:</span>                <span class="co">; beginning of procedure</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">add</span> <span class="kw">eax</span><span class="op">,</span> <span class="kw">ebx</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">add</span> <span class="kw">eax</span><span class="op">,</span> <span class="kw">ecx</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">ret</span>           <span class="co">; end of procedure</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
<div class="callout callout-style-simple callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<div>
<p><strong>Write an assembly program to add two vectors <code>A</code> and <code>B</code> to obtain vector <code>C</code>. The program starts by getting the values of <code>A</code> and <code>B</code> from a user, then it prints out the vector <code>C</code>.</strong></p>
</div>
<p><em>Solution</em>:</p>
<p>The general algorithm for this problem is as follows:</p>
<ol type="1">
<li>Read vector A</li>
<li>Read vector B</li>
<li>Computer C such that C[i] = A[i] + B[i]</li>
<li>Print vector C</li>
</ol>
<p>Thus, we divide our problem into three sub-problems:</p>
<ol type="1">
<li>Reading a vector from a console</li>
<li>Adding two vectors</li>
<li>Printing out a vector to the console</li>
</ol>
<p>Hence, the structure of our program is shown in <a href="#fig-structure" class="quarto-xref">Figure&nbsp;9</a>.</p>
<div id="fig-structure" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-structure-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="..\images/vectors.png" id="fig-structure" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-structure-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9
</figcaption>
</figure>
</div>
<p>In this exercise, we are going to write a separate file for each procedure:</p>
<ol type="1">
<li><code>readvector.asm</code>, which contains <code>readVector</code> procedure.</li>
<li><code>addvectors.asm</code>, which contains addVectors procedure.</li>
<li><code>printvector.asm</code>, which contains printVector procedure.</li>
<li><code>main.asm</code>, which contains the main procedure.</li>
</ol>
<div class="sourceCode" id="cb22" data-code-line-numbers=""><pre class="sourceCode nasm code-with-copy"><code class="sourceCode nasm"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">;------------------------------------------------</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co">; File: readvector.asm</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co">;------------------------------------------------</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>            <span class="kw">global</span>  readVector</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>            <span class="kw">extern</span>  _scanf</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>            <span class="kw">extern</span>  _printf</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>            <span class="kw">section</span> <span class="fu">.data</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>scan_fmt    <span class="dt">db</span>  <span class="st">"%d"</span><span class="op">,</span> <span class="dv">0</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>            <span class="kw">section</span> <span class="fu">.code</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="co">;------------------------------------------------</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co">; Read a vector from a console user </span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="co">; </span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="co">; Receives: </span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="co">;   EAX:    Input prompt</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="co">;   EDI:    A pointer to the vector</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="co">;   ECX:    Number of elements in the vector</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="co">;</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="co">; Returns:</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="co">;   A vector pointed by EDI register</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a><span class="co">;</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a><span class="co">; Requires: Nothing</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a><span class="co">;-------------------------------------------------</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a><span class="fu">readVector:</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>            <span class="co">; store EDI and ECX</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>            <span class="kw">push</span>    <span class="kw">edi</span> </span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>            <span class="kw">push</span>    <span class="kw">ecx</span> </span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>            <span class="co">; print input prompt</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>            <span class="kw">push</span>    <span class="kw">eax</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>            <span class="cf">call</span>    _printf</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>            <span class="kw">pop</span>     <span class="kw">eax</span></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>            <span class="co">; restore EDI and ECX</span></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>            <span class="kw">pop</span>     <span class="kw">ecx</span></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>            <span class="kw">pop</span>     <span class="kw">edi</span> </span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a><span class="fu">top:</span></span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>            <span class="kw">push</span>    <span class="kw">ecx</span>         <span class="co">; store it again</span></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>            <span class="kw">push</span>    <span class="kw">edi</span></span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>            <span class="kw">push</span>    scan_fmt</span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>            <span class="cf">call</span>    _scanf</span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>            <span class="kw">add</span>     <span class="kw">esp</span><span class="op">,</span> <span class="dv">4</span></span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>            <span class="kw">pop</span>     <span class="kw">edi</span></span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>            <span class="kw">pop</span>     <span class="kw">ecx</span></span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>            <span class="kw">add</span>     <span class="kw">edi</span><span class="op">,</span> <span class="dv">4</span></span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>            <span class="kw">loop</span>    top</span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">ret</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb23" data-code-line-numbers=""><pre class="sourceCode nasm code-with-copy"><code class="sourceCode nasm"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">;------------------------------------------------</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co">; File: addvectors.asm</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co">;------------------------------------------------</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>            <span class="kw">global</span> addVectors</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>            <span class="kw">section</span> <span class="fu">.code</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co">;------------------------------------------------</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co">; Add two vectors </span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co">; </span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co">; Receives: </span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co">;   EAX:    A pointer to the first vector</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="co">;   EBX:    A pointer to the second vector</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="co">;   EDI:    A pointer to the resulted vector</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="co">;   ECX:    Number of elements in the vector</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="co">;</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="co">; Returns:</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="co">;   The new vector pointed by EDI</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="co">;</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a><span class="co">; Requires: Nothing</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="co">;-------------------------------------------------</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="fu">addVectors:</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>            <span class="co">; save all data registers</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>            <span class="kw">pushad</span>              </span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="fu">top:</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>            <span class="kw">mov</span>     <span class="kw">edx</span><span class="op">,</span> <span class="op">[</span><span class="kw">eax</span><span class="op">]</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>            <span class="kw">add</span>     <span class="kw">edx</span><span class="op">,</span> <span class="op">[</span><span class="kw">ebx</span><span class="op">]</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>            <span class="kw">mov</span>     <span class="op">[</span><span class="kw">edi</span><span class="op">],</span> <span class="kw">edx</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>            <span class="kw">add</span>     <span class="kw">eax</span><span class="op">,</span> <span class="dv">4</span></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>            <span class="kw">add</span>     <span class="kw">ebx</span><span class="op">,</span> <span class="dv">4</span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>            <span class="kw">add</span>     <span class="kw">edi</span><span class="op">,</span> <span class="dv">4</span></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>            <span class="kw">loop</span>    top</span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>            <span class="co">; restore all data registers</span></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>            <span class="kw">popad</span></span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">ret</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb24" data-code-line-numbers=""><pre class="sourceCode nasm code-with-copy"><code class="sourceCode nasm"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">;------------------------------------------------</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co">; File: printvector.asm</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co">;------------------------------------------------</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>            <span class="kw">global</span>  printVector</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>            <span class="kw">extern</span>  _printf</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>            <span class="kw">section</span> <span class="fu">.data</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>printf_fmt  <span class="dt">db</span>  <span class="st">"%d"</span><span class="op">,</span> <span class="dv">13</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">0</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>            <span class="kw">section</span> <span class="fu">.code</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="co">;------------------------------------------------</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="co">; Print out vector to the console screen</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="co">; </span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="co">; Receives: </span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="co">;   EAX:    Output prompt</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="co">;   EDI:    A pointer to the vector</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="co">;   ECX:    Number of elements in the vector</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="co">;</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a><span class="co">; Returns: Nothing</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a><span class="co">;</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a><span class="co">; Requires: Nothing</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a><span class="co">;-------------------------------------------------</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a><span class="fu">printVector:</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>            <span class="co">; store EDI and ECX</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>            <span class="kw">push</span>    <span class="kw">edi</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>            <span class="kw">push</span>    <span class="kw">ecx</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>            <span class="kw">push</span>    <span class="kw">eax</span></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">call</span>    _printf</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>            <span class="kw">pop</span>     <span class="kw">eax</span></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>            <span class="co">; restore EDI and ECX</span></span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>            <span class="kw">pop</span>     <span class="kw">ecx</span></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>            <span class="kw">pop</span>     <span class="kw">edi</span></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a><span class="fu">top:</span></span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>            <span class="kw">push</span>    <span class="kw">ecx</span></span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>            <span class="kw">push</span>    <span class="kw">edi</span></span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>            <span class="kw">push</span>    <span class="dt">DWORD</span> <span class="op">[</span><span class="kw">edi</span><span class="op">]</span></span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>            <span class="kw">push</span>    printf_fmt</span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>            <span class="cf">call</span>    _printf</span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a>            <span class="kw">add</span>     <span class="kw">esp</span><span class="op">,</span> <span class="dv">8</span></span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a>            <span class="kw">pop</span>     <span class="kw">edi</span></span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a>            <span class="kw">pop</span>     <span class="kw">ecx</span></span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a>            <span class="kw">add</span>     <span class="kw">edi</span><span class="op">,</span> <span class="dv">4</span></span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a>            <span class="kw">loop</span>    top</span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a>            <span class="cf">ret</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb25" data-code-line-numbers=""><pre class="sourceCode nasm code-with-copy"><code class="sourceCode nasm"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">;------------------------------------------------</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co">; File: main.asm</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co">;------------------------------------------------</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>            <span class="kw">global</span> _main</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>            <span class="kw">extern</span> readVector</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>            <span class="kw">extern</span> printVector</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>            <span class="kw">extern</span> addVectors</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>            <span class="kw">section</span> <span class="fu">.data</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>prompt1     <span class="dt">db</span>      <span class="st">"Enter vector A:"</span><span class="op">,</span> <span class="dv">13</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">0</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>prompt2     <span class="dt">db</span>      <span class="st">"Enter vector B:"</span><span class="op">,</span> <span class="dv">13</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">0</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>output_msg  <span class="dt">db</span>      <span class="st">"Vector C:"</span><span class="op">,</span> <span class="dv">13</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">0</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>VECSIZE     <span class="dt">equ</span>     <span class="dv">5</span>   <span class="co">; number of elements in the vector</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>            <span class="kw">section</span> <span class="fu">.bss</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>vecA        <span class="dt">resd</span>    VECSIZE</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>vecB        <span class="dt">resd</span>    VECSIZE</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>vecC        <span class="dt">resd</span>    VECSIZE</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>            <span class="kw">section</span> <span class="fu">.code</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a><span class="co">;------------------------------------------------</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a><span class="co">; The main procedure</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a><span class="co">;------------------------------------------------</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a><span class="fu">_main:</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>            <span class="kw">mov</span>     <span class="kw">eax</span><span class="op">,</span> prompt1</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>            <span class="kw">mov</span>     <span class="kw">edi</span><span class="op">,</span> vecA</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>            <span class="kw">mov</span>     <span class="kw">ecx</span><span class="op">,</span> VECSIZE</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">call</span>    readVector</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>            <span class="kw">mov</span>     <span class="kw">eax</span><span class="op">,</span> prompt2</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>            <span class="kw">mov</span>     <span class="kw">edi</span><span class="op">,</span> vecB</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>            <span class="kw">mov</span>     <span class="kw">ecx</span><span class="op">,</span> VECSIZE</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>            <span class="cf">call</span>    readVector</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>            <span class="kw">mov</span>     <span class="kw">eax</span><span class="op">,</span> vecA</span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>            <span class="kw">mov</span>     <span class="kw">ebx</span><span class="op">,</span> vecB </span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>            <span class="kw">mov</span>     <span class="kw">edi</span><span class="op">,</span> vecC</span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>            <span class="kw">mov</span>     <span class="kw">ecx</span><span class="op">,</span> VECSIZE</span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">call</span>    addVectors</span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>            <span class="kw">mov</span>     <span class="kw">eax</span><span class="op">,</span> output_msg</span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a>            <span class="kw">mov</span>     <span class="kw">edi</span><span class="op">,</span> vecC</span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a>            <span class="kw">mov</span>     <span class="kw">ecx</span><span class="op">,</span> VECSIZE</span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a>            <span class="cf">call</span>    printVector</span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a>            <span class="kw">xor</span>     <span class="kw">eax</span><span class="op">,</span> <span class="kw">eax</span></span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a>            <span class="cf">ret</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/khalid-elbadawi\.github\.io\/C404\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<script src="../site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.js" defer="true"></script>
</body></html>